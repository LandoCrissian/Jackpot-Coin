<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jackpot Token (JACKPOT)</title>
  <meta name="description" content="Jackpot Token ‚Äî SOL payouts, verifiable on-chain." />
  <meta name="theme-color" content="#070A0F" />

  <style>
    :root{
      --bg:#070A0F;
      --card:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.09);
      --text:#EAF1FB;
      --muted:#9AA4B2;
      --accent:#34D399;
      --accent2:#7C3AED;
      --shadow:0 18px 55px rgba(0,0,0,.55);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 420px at 15% -10%, rgba(52,211,153,.18), transparent 60%),
        radial-gradient(800px 420px at 85% 0%, rgba(124,58,237,.18), transparent 55%),
        var(--bg);
    }
    .wrap{max-width:1040px;margin:0 auto;padding:18px 16px 64px}

    header{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;padding:10px 0 16px}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logoImg{
      width:54px;height:54px;border-radius:16px;
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      background:rgba(255,255,255,.03);
      object-fit:cover;
      flex:0 0 auto;
    }

    .brandText{min-width:0}
    .brandText h1{margin:0;font-size:18px;letter-spacing:.3px;line-height:1.15}
    .brandText p{
      margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.25;
      white-space:normal; /* IMPORTANT: no cutoff */
      overflow:visible;
      max-width:520px;
    }

    .ctaRow{
      display:grid;
      grid-template-columns:repeat(3, minmax(0, 1fr));
      gap:10px;
      width:min(520px, 100%);
      justify-items:stretch;
    }

    @media (max-width:900px){
      header{flex-direction:column;align-items:flex-start}
      .ctaRow{width:100%}
    }

    .btn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      text-decoration:none;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:transform .08s ease, background .2s ease, border-color .2s ease;
      -webkit-tap-highlight-color:transparent;
      white-space:nowrap;
    }
    .btn:active{transform:translateY(1px)}
    .btn:hover{background:rgba(255,255,255,.06)}
    .btnPrimary{
      background:linear-gradient(135deg, rgba(52,211,153,.20), rgba(124,58,237,.16));
      border-color:rgba(255,255,255,.11);
    }

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:10px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{
      border:1px solid var(--stroke);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      overflow:hidden;
      position:relative;
    }
    .cardGlow:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 240px at 18% 0%, rgba(52,211,153,.22), transparent 60%),
        radial-gradient(600px 240px at 82% 0%, rgba(124,58,237,.18), transparent 60%);
      pointer-events:none;
      filter:saturate(1.1);
    }
    .cardGlow>*{position:relative}

    .kicker{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.20);
      color:var(--muted);
      font-size:12px;
      margin-bottom:10px;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent);box-shadow:0 0 18px rgba(52,211,153,.55)}
    h2{margin:0 0 6px;font-size:26px;letter-spacing:.2px}
    .sub{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.55}

    .statusRow{display:flex;gap:10px;flex-wrap:wrap;margin:0 0 14px}
    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--stroke);
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.02);
      white-space:nowrap;
      text-decoration:none;
    }
    .pill strong{color:var(--text);font-weight:700}

    .countWrap{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:520px){.countWrap{grid-template-columns:repeat(2,1fr)}}
    .timeBox{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.22);
      border-radius:16px;
      padding:12px 12px 10px;
      min-height:74px;
    }
    .timeLabel{color:var(--muted);font-size:12px;margin-bottom:6px;letter-spacing:.2px}
    .timeVal{font-family:var(--mono);font-weight:800;font-size:22px;letter-spacing:1px}
    .timeValAccent{color:var(--accent)}

    .rowTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:16px 0 10px}
    .rowTitle .label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px}
    .addr{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      border-radius:16px;
      padding:10px 10px 10px 12px;
    }
    .addr code{
      font-family:var(--mono);
      font-size:12.5px;
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
    }
    .miniBtn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      border-radius:12px;
      padding:9px 10px;
      font-size:12px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .miniBtn:active{transform:translateY(1px)}

    .trust{margin-top:14px;border:1px solid var(--stroke);background:rgba(0,0,0,.18);border-radius:16px;padding:12px}
    .trust h3{margin:0 0 8px;font-size:12px;letter-spacing:.9px;text-transform:uppercase;color:var(--muted)}
    .trust ul{margin:0;padding-left:18px}
    .trust li{margin:6px 0;color:var(--muted);font-size:13px;line-height:1.45}
    .trust b{color:var(--text);font-weight:700}

    .sectionHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .sectionHead h3{margin:0;font-size:12px;letter-spacing:.9px;text-transform:uppercase;color:var(--muted)}
    .badge{
      display:inline-flex;align-items:center;gap:6px;border:1px solid var(--stroke);
      background:rgba(255,255,255,.02);color:var(--muted);
      padding:6px 10px;border-radius:999px;font-size:12px;white-space:nowrap;
    }
    .badge strong{color:var(--text);font-weight:700}

    .winners{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    .win{
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .winLeft{min-width:0}
    .who{
      font-family:var(--mono);
      font-size:13px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:62vw;
    }
    .meta{
      margin-top:6px;font-size:12px;color:var(--muted);
      line-height:1.35;display:flex;flex-wrap:wrap;gap:8px;align-items:center;
    }
    a{color:var(--text);text-decoration:none;border-bottom:1px solid rgba(255,255,255,.18)}
    a:hover{border-bottom-color:rgba(255,255,255,.45)}
    .amt{font-family:var(--mono);font-weight:900;font-size:13px;color:var(--accent);white-space:nowrap}

    .iconBtn{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      display:inline-flex;
      align-items:center;
      gap:6px;
      text-decoration:none;
      border-bottom:none;
    }
    .iconBtn:hover{background:rgba(255,255,255,.06)}
    .foot{margin-top:12px;color:var(--muted);font-size:12px;line-height:1.55}

    .toast{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.25);
      color:var(--muted);
      padding:10px 12px;
      border-radius:14px;
      font-size:12px;
      display:none;
    }
    .toast.show{display:block}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img class="logoImg" alt="Jackpot logo" src="https://raw.githubusercontent.com/LandoCrissian/Jackpot-Coin/refs/heads/main/IMG_9059.jpeg" />
        <div class="brandText">
          <h1>Jackpot Token <span style="color:var(--muted); font-weight:700;">(JACKPOT)</span></h1>
          <p id="subtitle">SOL payouts ‚Ä¢ On-chain verification ‚Ä¢ Live cadence</p>
        </div>
      </div>

      <div class="ctaRow">
        <a class="btn" href="https://x.com/i/communities/2003560731950612759" target="_blank" rel="noopener">Community ‚Üó</a>
        <a class="btn" href="https://t.me/JackpotCoinCto" target="_blank" rel="noopener">Telegram ‚Üó</a>
        <a class="btn btnPrimary" href="https://pfv2.fun/trade/7ng7j9kyRQNvaJCfJwLcxsWBYxi37biGgudcF3fVaGV2" target="_blank" rel="noopener">Trade on Pump v2 ‚Üó</a>
      </div>
    </header>

    <div class="grid">
      <section class="card cardGlow">
        <div class="kicker"><span class="dot"></span> Provably paid ‚Ä¢ Verifiable on Solscan</div>
        <h2>Next Jackpot Draw</h2>
        <p class="sub">
          Countdown is synced to the <b>most recent on-chain payout</b>. Every winner below includes a direct Solscan proof link.
        </p>

        <div class="statusRow">
          <div class="pill"><strong>Status</strong>: <span id="liveStatus">Loading‚Ä¶</span></div>
          <div class="pill"><strong>Last payout</strong>: <span id="lastPayout">‚Äî</span></div>
          <a class="pill" id="payoutWalletLink" href="#" target="_blank" rel="noopener"><strong>Payout wallet</strong>: View ‚Üó</a>
        </div>

        <div class="countWrap" role="group" aria-label="Countdown timer">
          <div class="timeBox">
            <div class="timeLabel">Minutes</div>
            <div class="timeVal" id="cdMin">--</div>
          </div>
          <div class="timeBox">
            <div class="timeLabel">Seconds</div>
            <div class="timeVal timeValAccent" id="cdSec">--</div>
          </div>
          <div class="timeBox">
            <div class="timeLabel">Next draw (UTC)</div>
            <div class="timeVal" style="font-size:14px; letter-spacing:.2px" id="nextUtc">--</div>
          </div>
          <div class="timeBox">
            <div class="timeLabel">Cadence (observed)</div>
            <div class="timeVal" style="font-size:14px; letter-spacing:.2px" id="cadenceText">‚Äî</div>
          </div>
        </div>

        <div class="rowTitle">
          <div class="label">Contract address</div>
          <div class="pill">Network: Solana</div>
        </div>

        <div class="addr">
          <code id="contractAddr">7ng7j9kyRQNvaJCfJwLcxsWBYxi37biGgudcF3fVaGV2</code>
          <button class="miniBtn" id="copyBtn" type="button">Copy</button>
        </div>

        <div class="trust" aria-label="Trust and transparency">
          <h3>Trust & transparency</h3>
          <ul>
            <li><b>On-chain payouts:</b> winners are paid directly on Solana.</li>
            <li><b>System Program transfers:</b> standard native SOL transfers.</li>
            <li><b>Independent verification:</b> every winner links to Solscan proof.</li>
            <li><b>Read-only site:</b> no wallet connect, no permissions, no approvals.</li>
          </ul>
        </div>

        <div class="foot">
          Always verify the contract address and transactions via official links.
        </div>

        <div class="toast" id="toast"></div>
      </section>

      <aside class="card">
        <div class="sectionHead">
          <h3>Recent winners</h3>
          <span class="badge" id="updatedBadge"><strong>Updated</strong>: --</span>
        </div>

        <ul class="winners" id="winnersList"></ul>

        <div class="foot">
          Winners are pulled from on-chain System Program transfers from the payout wallet.
        </div>
      </aside>
    </div>
  </div>

  <script>
    const CONFIG = {
      api: "/.netlify/functions/get-winners",
      solscanTxBase: "https://solscan.io/tx/",
      solscanAccountBase: "https://solscan.io/account/",
      contract: "7ng7j9kyRQNvaJCfJwLcxsWBYxi37biGgudcF3fVaGV2",
      community: "https://x.com/i/communities/2003560731950612759",
      telegram: "https://t.me/JackpotCoinCto",
      trade: "https://pfv2.fun/trade/7ng7j9kyRQNvaJCfJwLcxsWBYxi37biGgudcF3fVaGV2",
      site: "https://www.jackpotcoin.fun/",
      cadenceMs: 15 * 60 * 1000, // fallback until API loads
    };

    let lastPayoutUTC_FROM_API = null;

    function pad2(n){ return String(n).padStart(2, "0"); }
    function shortAddr(a){ return (!a || a.length < 12) ? (a || "") : a.slice(0,6)+"‚Ä¶"+a.slice(-4); }
    function utcString(iso){ try { return new Date(iso).toUTCString(); } catch { return ""; } }
    function minutesAgo(iso){
      if(!iso) return null;
      const ms = Date.now() - Date.parse(iso);
      if (!Number.isFinite(ms)) return null;
      return Math.max(0, Math.floor(ms / 60000));
    }
    function formatUtcHM(ms){
      const d = new Date(ms);
      return `${pad2(d.getUTCHours())}:${pad2(d.getUTCMinutes())} UTC`;
    }

    function showToast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.classList.remove("show"), 2200);
    }

    function computeNextDrawMs(nowMs, lastPayoutUTC){
      const lastMs = lastPayoutUTC ? Date.parse(lastPayoutUTC) : NaN;
      if (!Number.isNaN(lastMs)) {
        if (nowMs <= lastMs) return lastMs + CONFIG.cadenceMs;
        const elapsed = nowMs - lastMs;
        const steps = Math.floor(elapsed / CONFIG.cadenceMs) + 1;
        return lastMs + steps * CONFIG.cadenceMs;
      }
      return Math.ceil(nowMs / CONFIG.cadenceMs) * CONFIG.cadenceMs;
    }

    function tickCountdown(){
      const now = Date.now();
      const next = computeNextDrawMs(now, lastPayoutUTC_FROM_API);
      const diff = Math.max(0, next - now);
      const totalSec = Math.floor(diff / 1000);
      const minutes = Math.floor(totalSec / 60);
      const seconds = totalSec % 60;

      document.getElementById("cdMin").textContent = pad2(minutes);
      document.getElementById("cdSec").textContent = pad2(seconds);
      document.getElementById("nextUtc").textContent = formatUtcHM(next);
    }
    setInterval(tickCountdown, 250);
    tickCountdown();

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const btn = document.getElementById("copyBtn");
      try{
        await navigator.clipboard.writeText(CONFIG.contract);
        const old = btn.textContent;
        btn.textContent = "Copied";
        setTimeout(() => btn.textContent = old, 900);
      }catch(e){
        alert("Copy failed. Please copy manually.");
      }
    });

    function setUpdatedBadge(iso){
      const el = document.getElementById("updatedBadge");
      el.innerHTML = iso ? `<strong>Updated</strong>: ${utcString(iso)}` : `<strong>Updated</strong>: ‚Äî`;
    }

    function setStatus(data){
      const live = document.getElementById("liveStatus");
      const last = document.getElementById("lastPayout");
      const walletLink = document.getElementById("payoutWalletLink");
      walletLink.href = data?.payoutWalletUrl || "#";

      if (data?.error === "feed_unavailable") {
        live.textContent = "Feed unstable";
      } else {
        live.textContent = "Live";
      }

      const m = minutesAgo(data?.lastPayoutUTC);
      last.textContent = (m === null) ? "‚Äî" : `${m}m ago`;
    }

    function xShareUrl(w){
      const amt = (typeof w.amountSOL === "number") ? w.amountSOL.toFixed(4) : w.amountSOL;
      const txUrl = w.solscanUrl || (w.tx ? (CONFIG.solscanTxBase + w.tx) : "");
      const text =
`üéâ Jackpot winner paid on Solana
üí∞ ${amt} SOL
üîç Proof: ${txUrl}

Join the community:
${CONFIG.community}

Telegram:
${CONFIG.telegram}

Trade JACKPOT:
${CONFIG.trade}

Live status:
${CONFIG.site}`;
      return "https://twitter.com/intent/tweet?text=" + encodeURIComponent(text);
    }

    function winnerItem(w){
      const walletFull = (w.wallet || "").trim();
      const tx = (w.tx || "").trim();
      const walletShort = shortAddr(walletFull);

      const solscanWallet = walletFull ? (CONFIG.solscanAccountBase + walletFull) : null;
      const solscanTx = w.solscanUrl || (tx ? (CONFIG.solscanTxBase + tx) : null);

      const amount = typeof w.amountSOL === "number" ? `${w.amountSOL.toFixed(4)} SOL` : (w.amountSOL || "‚Äî");
      const when = w.whenUTC ? utcString(w.whenUTC) : "‚Äî";

      const li = document.createElement("li");
      li.className = "win";
      li.innerHTML = `
        <div class="winLeft">
          <div class="who" title="${walletFull}">
            ${solscanWallet ? `<a href="${solscanWallet}" target="_blank" rel="noopener">${walletShort}</a>` : walletShort}
          </div>
          <div class="meta">
            <span>${when}</span>
            ${solscanTx ? `<span>‚Ä¢</span><a href="${solscanTx}" target="_blank" rel="noopener">View proof ‚Üó</a>` : ""}
            ${solscanTx ? `<span>‚Ä¢</span><a class="iconBtn" href="${xShareUrl(w)}" target="_blank" rel="noopener">Share ùïè ‚Üó</a>` : ""}
          </div>
        </div>
        <div class="amt">${amount}</div>
      `;
      return li;
    }

    function renderWinners(listEl, winners){
      listEl.innerHTML = "";
      if (!winners.length) {
        const empty = document.createElement("li");
        empty.className = "win";
        empty.innerHTML = `
          <div class="winLeft">
            <div class="who">No payouts detected yet</div>
            <div class="meta">When the payout wallet sends a System Program SOL transfer, it will appear here with proof.</div>
          </div>
          <div class="amt">‚Äî</div>`;
        listEl.appendChild(empty);
        return;
      }
      winners.forEach(w => listEl.appendChild(winnerItem(w)));
    }

    // show last good winners immediately on load (better UX)
    (function bootFromStorage(){
      const list = document.getElementById("winnersList");
      const key = "jackpot_last_good_payload_v1";
      try{
        const saved = JSON.parse(localStorage.getItem(key) || "null");
        if (saved?.winners?.length) {
          setUpdatedBadge(saved.updatedUTC || null);
          setStatus(saved);
          renderWinners(list, saved.winners);
        }
      }catch{}
    })();

    async function loadWinners(){
  const list = document.getElementById("winnersList");
  const keyLastGood = "jackpot_last_good_payload_v1";

  try{
    const res = await fetch(CONFIG.api, { cache: "no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    // If the function says it‚Äôs stale / unstable, do NOT re-render list with empty data
    if (data?.error === "feed_unavailable") {
      showToast("RPC hiccup ‚Äî keeping last winners");
      setStatus(data);
      return;
    }

    // If winners comes back empty but we already have last good winners, keep them
    const incoming = Array.isArray(data.winners) ? data.winners : [];
    if (incoming.length === 0) {
      const saved = JSON.parse(localStorage.getItem(keyLastGood) || "null");
      if (saved?.winners?.length) {
        showToast("Waiting for RPC index‚Ä¶ keeping last winners");
        setUpdatedBadge(data.updatedUTC || null);
        setStatus(data);
        return; // IMPORTANT: don‚Äôt wipe UI
      }
    }

    // Normal good update path
    lastPayoutUTC_FROM_API = data.lastPayoutUTC || null;

    if (typeof data.cadenceSeconds === "number" && data.cadenceSeconds > 0) {
      CONFIG.cadenceMs = data.cadenceSeconds * 1000;
    }
    document.getElementById("cadenceText").textContent =
      `~${Math.round(CONFIG.cadenceMs / 60000)} min`;

    setUpdatedBadge(data.updatedUTC);
    setStatus(data);

    renderWinners(list, incoming);

    // Persist last good payload
    localStorage.setItem(keyLastGood, JSON.stringify({
      updatedUTC: data.updatedUTC,
      payoutWalletUrl: data.payoutWalletUrl,
      lastPayoutUTC: data.lastPayoutUTC,
      winners: incoming
    }));

  }catch(e){
    showToast("Feed unavailable ‚Äî keeping last winners");
    document.getElementById("liveStatus").textContent = "Feed unstable";
    // IMPORTANT: don‚Äôt clear winners on error
  }
}

    loadWinners();
    setInterval(loadWinners, 12_000); // faster UX without crushing RPC (server caches)
  </script>
</body>
</html>
